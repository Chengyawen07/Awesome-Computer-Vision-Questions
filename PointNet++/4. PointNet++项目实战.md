# 4. PointNet++ 项目实战

- 完整流程 = 读取数据 → 预处理 → 运行 PointNet++ → 输出结果

## **1️⃣ 输入数据**

**数据来源**：

- **3D 传感器**（如 LiDAR、RGB-D 相机）
- **公开数据集**（如 ModelNet40、ShapeNet、ScanNet）
- **3D 计算重建**（SfM, MVS）

**数据格式**：

- **点云数据（PCD, PLY, XYZ）**
- **深度图（Depth Image）**
- **ROS2 传感器消息 (`sensor_msgs/PointCloud2`)**

📌 **示例：读取 PCD 文件**

```python
import open3d as o3d
pcd = o3d.io.read_point_cloud("data.pcd")
o3d.visualization.draw_geometries([pcd])
```

------



## **2️⃣ 数据预处理**

**主要任务**： 

✅ **降噪**（去除离群点） 

✅ **采样**（减少数据量，提高计算效率） 

✅ **坐标归一化**（让点云对齐到相同尺度） 

✅ **数据增强**（随机旋转、缩放）

📌 **示例：点云降噪 + 体素下采样**

```python
pcd = pcd.voxel_down_sample(voxel_size=0.02)  # 体素下采样
pcd, _ = pcd.remove_statistical_outlier(nb_neighbors=20, std_ratio=2.0)  # 统计滤波
```

------



## **3️⃣ 运行 PointNet++ 算法**

**PointNet++ 处理流程**： 

1️⃣ **最远点采样（FPS）** → 选择中心点

2️⃣ **局部分组（Grouping）** → 选定邻居点

3️⃣ **局部特征提取（PointNet 层）** → 提取局部信息

4️⃣ **多层次特征聚合** → 形成最终全局特征

📌 **示例：运行 PointNet++**

```python
import torch
from pointnet2.models import PointNet2ClassificationSSG

model = PointNet2ClassificationSSG(num_classes=40)
model.eval()

point_cloud = torch.rand(1, 3, 1024)  # 1 组点云，3D 坐标，1024 个点
output = model(point_cloud)
print("预测类别:", output.argmax(dim=1))
```

------



## **4️⃣ 输出**

**分类任务**：

- **输出物体类别**（如“飞机”、“桌子”）

**分割任务**：

- **每个点的标签**（如“桌面”、“地面”、“障碍物”）

**目标检测任务**：

- **3D 目标边界框**（类似 YOLO）

📌 **示例：可视化分割结果**

```python
import matplotlib.pyplot as plt
import numpy as np

pred_labels = np.random.randint(0, 10, size=(1024,))
plt.scatter(np.random.rand(1024), np.random.rand(1024), c=pred_labels, cmap="jet")
plt.colorbar()
plt.show()
```

------



## **5️⃣ 总结**

| **步骤**        | **任务**                       | **示例代码**                   |
| --------------- | ------------------------------ | ------------------------------ |
| **1. 输入**     | 获取点云数据（PCD, PLY, ROS2） | `open3d.io.read_point_cloud()` |
| **2. 预处理**   | 过滤噪声、采样、归一化         | `voxel_down_sample()`          |
| **3. 运行算法** | 采样、分组、局部特征提取       | `PointNet2ClassificationSSG()` |
| **4. 输出**     | 分类、分割、目标检测           | `plt.scatter()`                |





