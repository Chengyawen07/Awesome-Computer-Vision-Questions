# 4. PointNet++ é¡¹ç›®å®æˆ˜

- å®Œæ•´æµç¨‹ = è¯»å–æ•°æ® â†’ é¢„å¤„ç† â†’ è¿è¡Œ PointNet++ â†’ è¾“å‡ºç»“æœ

## **1ï¸âƒ£ è¾“å…¥æ•°æ®**

**æ•°æ®æ¥æº**ï¼š

- **3D ä¼ æ„Ÿå™¨**ï¼ˆå¦‚ LiDARã€RGB-D ç›¸æœºï¼‰
- **å…¬å¼€æ•°æ®é›†**ï¼ˆå¦‚ ModelNet40ã€ShapeNetã€ScanNetï¼‰
- **3D è®¡ç®—é‡å»º**ï¼ˆSfM, MVSï¼‰

**æ•°æ®æ ¼å¼**ï¼š

- **ç‚¹äº‘æ•°æ®ï¼ˆPCD, PLY, XYZï¼‰**
- **æ·±åº¦å›¾ï¼ˆDepth Imageï¼‰**
- **ROS2 ä¼ æ„Ÿå™¨æ¶ˆæ¯ (`sensor_msgs/PointCloud2`)**

ğŸ“Œ **ç¤ºä¾‹ï¼šè¯»å– PCD æ–‡ä»¶**

```python
import open3d as o3d
pcd = o3d.io.read_point_cloud("data.pcd")
o3d.visualization.draw_geometries([pcd])
```

------



## **2ï¸âƒ£ æ•°æ®é¢„å¤„ç†**

**ä¸»è¦ä»»åŠ¡**ï¼š 

âœ… **é™å™ª**ï¼ˆå»é™¤ç¦»ç¾¤ç‚¹ï¼‰ 

âœ… **é‡‡æ ·**ï¼ˆå‡å°‘æ•°æ®é‡ï¼Œæé«˜è®¡ç®—æ•ˆç‡ï¼‰ 

âœ… **åæ ‡å½’ä¸€åŒ–**ï¼ˆè®©ç‚¹äº‘å¯¹é½åˆ°ç›¸åŒå°ºåº¦ï¼‰ 

âœ… **æ•°æ®å¢å¼º**ï¼ˆéšæœºæ—‹è½¬ã€ç¼©æ”¾ï¼‰

ğŸ“Œ **ç¤ºä¾‹ï¼šç‚¹äº‘é™å™ª + ä½“ç´ ä¸‹é‡‡æ ·**

```python
pcd = pcd.voxel_down_sample(voxel_size=0.02)  # ä½“ç´ ä¸‹é‡‡æ ·
pcd, _ = pcd.remove_statistical_outlier(nb_neighbors=20, std_ratio=2.0)  # ç»Ÿè®¡æ»¤æ³¢
```

------



## **3ï¸âƒ£ è¿è¡Œ PointNet++ ç®—æ³•**

**PointNet++ å¤„ç†æµç¨‹**ï¼š 

1ï¸âƒ£ **æœ€è¿œç‚¹é‡‡æ ·ï¼ˆFPSï¼‰** â†’ é€‰æ‹©ä¸­å¿ƒç‚¹

2ï¸âƒ£ **å±€éƒ¨åˆ†ç»„ï¼ˆGroupingï¼‰** â†’ é€‰å®šé‚»å±…ç‚¹

3ï¸âƒ£ **å±€éƒ¨ç‰¹å¾æå–ï¼ˆPointNet å±‚ï¼‰** â†’ æå–å±€éƒ¨ä¿¡æ¯

4ï¸âƒ£ **å¤šå±‚æ¬¡ç‰¹å¾èšåˆ** â†’ å½¢æˆæœ€ç»ˆå…¨å±€ç‰¹å¾

ğŸ“Œ **ç¤ºä¾‹ï¼šè¿è¡Œ PointNet++**

```python
import torch
from pointnet2.models import PointNet2ClassificationSSG

model = PointNet2ClassificationSSG(num_classes=40)
model.eval()

point_cloud = torch.rand(1, 3, 1024)  # 1 ç»„ç‚¹äº‘ï¼Œ3D åæ ‡ï¼Œ1024 ä¸ªç‚¹
output = model(point_cloud)
print("é¢„æµ‹ç±»åˆ«:", output.argmax(dim=1))
```

------



## **4ï¸âƒ£ è¾“å‡º**

**åˆ†ç±»ä»»åŠ¡**ï¼š

- **è¾“å‡ºç‰©ä½“ç±»åˆ«**ï¼ˆå¦‚â€œé£æœºâ€ã€â€œæ¡Œå­â€ï¼‰

**åˆ†å‰²ä»»åŠ¡**ï¼š

- **æ¯ä¸ªç‚¹çš„æ ‡ç­¾**ï¼ˆå¦‚â€œæ¡Œé¢â€ã€â€œåœ°é¢â€ã€â€œéšœç¢ç‰©â€ï¼‰

**ç›®æ ‡æ£€æµ‹ä»»åŠ¡**ï¼š

- **3D ç›®æ ‡è¾¹ç•Œæ¡†**ï¼ˆç±»ä¼¼ YOLOï¼‰

ğŸ“Œ **ç¤ºä¾‹ï¼šå¯è§†åŒ–åˆ†å‰²ç»“æœ**

```python
import matplotlib.pyplot as plt
import numpy as np

pred_labels = np.random.randint(0, 10, size=(1024,))
plt.scatter(np.random.rand(1024), np.random.rand(1024), c=pred_labels, cmap="jet")
plt.colorbar()
plt.show()
```

------

## **5ï¸âƒ£ æ€»ç»“**

| **æ­¥éª¤**        | **ä»»åŠ¡**                       | **ç¤ºä¾‹ä»£ç **                   |
| --------------- | ------------------------------ | ------------------------------ |
| **1. è¾“å…¥**     | è·å–ç‚¹äº‘æ•°æ®ï¼ˆPCD, PLY, ROS2ï¼‰ | `open3d.io.read_point_cloud()` |
| **2. é¢„å¤„ç†**   | è¿‡æ»¤å™ªå£°ã€é‡‡æ ·ã€å½’ä¸€åŒ–         | `voxel_down_sample()`          |
| **3. è¿è¡Œç®—æ³•** | é‡‡æ ·ã€åˆ†ç»„ã€å±€éƒ¨ç‰¹å¾æå–       | `PointNet2ClassificationSSG()` |
| **4. è¾“å‡º**     | åˆ†ç±»ã€åˆ†å‰²ã€ç›®æ ‡æ£€æµ‹           | `plt.scatter()`                |



## **6ï¸âƒ£ PointNet++ ä½¿ç”¨çš„æ•°æ®é›†**

PointNet++ ä¸»è¦ä½¿ç”¨ä»¥ä¸‹ **3D ç‚¹äº‘æ•°æ®é›†** è¿›è¡Œè®­ç»ƒå’Œæµ‹è¯•ï¼š

------



### **1. ModelNet40ï¼ˆ3D ç‰©ä½“åˆ†ç±»ï¼‰**

âœ… **æ•°æ®é›†ä»‹ç»**ï¼š

- **40 ç±» 3D ç‰©ä½“**ï¼ˆå¦‚æ¤…å­ã€æ¡Œå­ã€é£æœºã€æ±½è½¦ï¼‰ã€‚
- **12311 ä¸ªç‚¹äº‘æ¨¡å‹**ï¼ˆè®­ç»ƒé›† 9843ï¼Œæµ‹è¯•é›† 2468ï¼‰ã€‚
- æ¯ä¸ª 3D ç‰©ä½“éƒ½ç”± **1024 ä¸ªç‚¹** é‡‡æ ·ã€‚

âœ… **PointNet++ ä»»åŠ¡**ï¼š

- **ç‚¹äº‘åˆ†ç±»**ï¼ˆå°† 3D ç‰©ä½“åˆ†ç±»ä¸º 40 ä¸ªç±»åˆ«ï¼‰ã€‚

ğŸ“Œ **ç¤ºä¾‹ä»£ç ï¼ˆè¯»å– ModelNet40ï¼‰**

```python
from torch.utils.data import DataLoader
from pointnet2.data import ModelNet40Cls

# è¯»å– ModelNet40 æ•°æ®é›†
train_data = ModelNet40Cls(num_points=1024, train=True)
train_loader = DataLoader(train_data, batch_size=16, shuffle=True)

# å–å‡ºä¸€ä¸ªæ ·æœ¬
point_cloud, label = train_data[0]
print("ç‚¹äº‘å½¢çŠ¶:", point_cloud.shape)  # (1024, 3)
print("ç±»åˆ«æ ‡ç­¾:", label)
```

------

å¦‚ä¸‹æ˜¯NodelNetçš„å¯è§†åŒ–

![image-20250204175956001](/Users/cheng/Library/Application Support/typora-user-images/image-20250204175956001.png)



### **2. ShapeNet Partï¼ˆ3D ç‰©ä½“åˆ†å‰²ï¼‰**

âœ… **æ•°æ®é›†ä»‹ç»**ï¼š

- **16 ç±»ç‰©ä½“ï¼Œ50 ç§éƒ¨ä»¶**ï¼ˆå¦‚é£æœºçš„æœºç¿¼ã€æ±½è½¦çš„è½®å­ï¼‰ã€‚

- ```
  Airplane	02691156
  Bag	02773838
  Cap	02954340
  Car	02958343
  Chair	03001627
  Earphone	03261776
  Guitar	03467517
  Knife	03624134
  Lamp	03636649
  Laptop	03642806
  Motorbike	03790512
  Mug	03797390
  Pistol	03948459
  Rocket	04099429
  Skateboard	04225987
  Table	04379243
  ```

- **16681 ä¸ªç‚¹äº‘æ¨¡å‹**ã€‚

- æ¯ä¸ªç‚¹äº‘éƒ½å¸¦æœ‰ **åˆ†å‰²æ ‡ç­¾**ï¼Œæ ‡è®°ä¸åŒéƒ¨ä»¶ã€‚ï¼ˆä¹Ÿå°±æ˜¯txté™¤äº†xyz nxnynzä¹‹å¤–ï¼Œè¿˜æœ‰ç¬¬ä¸ƒä½æ˜¯æ ‡ç­¾(0,1,2,3),ä»£è¡¨ä¸åŒçš„éƒ¨ä»¶ï¼‰

âœ… **PointNet++ ä»»åŠ¡**ï¼š

- **ç‚¹äº‘åˆ†å‰²**ï¼ˆç»™æ¯ä¸ªç‚¹åˆ†é…ä¸€ä¸ªç±»åˆ«ï¼Œå¦‚æ¡Œé¢ã€æ¤…å­åº§ä½ï¼‰ã€‚

ğŸ“Œ **ç¤ºä¾‹ä»£ç ï¼ˆè¯»å– ShapeNetï¼‰**

```python
from pointnet2.data import ShapeNetPart

# è¯»å– ShapeNet Part æ•°æ®é›†
dataset = ShapeNetPart(num_points=2048, train=True)
point_cloud, label = dataset[0]

print("ç‚¹äº‘å½¢çŠ¶:", point_cloud.shape)  # (2048, 3)
print("åˆ†å‰²æ ‡ç­¾å½¢çŠ¶:", label.shape)  # (2048,)
```

------



### **3. ScanNetï¼ˆ3D åœºæ™¯åˆ†å‰²ï¼‰**

âœ… **æ•°æ®é›†ä»‹ç»**ï¼š

- **2.5 ä¸‡ä¸ªå®¤å†…åœºæ™¯**ï¼ˆå¦‚åŠå…¬å®¤ã€å§å®¤ï¼‰ã€‚
- **å…¨ 3D æ‰«æç‚¹äº‘**ï¼ŒåŒ…å«è¯­ä¹‰æ ‡ç­¾ï¼ˆå¢™å£ã€åœ°æ¿ã€æ¡Œå­ç­‰ï¼‰ã€‚

âœ… **PointNet++ ä»»åŠ¡**ï¼š

- **3D è¯­ä¹‰åˆ†å‰²**ï¼ˆç»™æ•´ä¸ªæˆ¿é—´çš„æ¯ä¸ªç‚¹æ‰“æ ‡ç­¾ï¼‰ã€‚

ğŸ“Œ **ç¤ºä¾‹ä»£ç ï¼ˆè¯»å– ScanNet æ•°æ®ï¼‰**

```python
from pointnet2.data import ScannetDataset

# è¯»å– ScanNet æ•°æ®é›†
dataset = ScannetDataset(num_points=4096, train=True)
point_cloud, label = dataset[0]

print("ç‚¹äº‘å½¢çŠ¶:", point_cloud.shape)  # (4096, 3)
print("è¯­ä¹‰åˆ†å‰²æ ‡ç­¾:", label.shape)  # (4096,)
```

------

![image-20250204180114611](/Users/cheng/Library/Application Support/typora-user-images/image-20250204180114611.png)





### **4. æ€»ç»“**

| **æ•°æ®é›†**        | **ä»»åŠ¡**    | **ç‚¹äº‘æ•°ç›®** | **ç±»åˆ«æ•°**                  |
| ----------------- | ----------- | ------------ | --------------------------- |
| **ModelNet40**    | 3D ç‰©ä½“åˆ†ç±» | 12311        | 40 ç±»                       |
| **ShapeNet Part** | 3D ç‰©ä½“åˆ†å‰² | 16681        | 16 ç±»ï¼ˆ50 ä¸ªéƒ¨ä»¶ï¼‰          |
| **ScanNet**       | 3D åœºæ™¯åˆ†å‰² | 2.5 ä¸‡       | 20 ç±»ï¼ˆå¦‚å¢™å£ã€åœ°æ¿ã€æ¡Œå­ï¼‰ |









